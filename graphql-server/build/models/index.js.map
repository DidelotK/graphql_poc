{"version":3,"sources":["../../src/models/index.js"],"names":["DB_URI","process","env","DEFAULT_CONF","DB_USER","DB_USER_PASSWORD","DB_NAME","DB_PORT","basename","path","__filename","models","sequelize","Sequelize","dialect","host","port","logging","operatorsAliases","Op","fs","readdirSync","__dirname","filter","file","indexOf","slice","forEach","model","join","name","Object","keys","modelName","associate","console","log"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAGA,IAAMA,SAASC,QAAQC,GAAR,CAAYF,MAAZ,IAAsBG,kBAAaH,MAAlD;AACA,IAAMI,UAAUH,QAAQC,GAAR,CAAYE,OAAZ,IAAuBD,kBAAaC,OAApD;AACA,IAAMC,mBAAmBJ,QAAQC,GAAR,CAAYG,gBAAZ,IAAgCF,kBAAaE,gBAAtE;AACA,IAAMC,UAAUL,QAAQC,GAAR,CAAYI,OAAZ,IAAuBH,kBAAaG,OAApD;AACA,IAAMC,UAAUN,QAAQC,GAAR,CAAYK,OAAZ,IAAuBJ,kBAAaI,OAApD;AACA,IAAMC,WAAWC,eAAKD,QAAL,CAAcE,UAAd,CAAjB;AACA,IAAMC,SAAS,EAAf;;AAEA;AACA,IAAMC,YAAY,IAAIC,mBAAJ,CAAcP,OAAd,EAAuBF,OAAvB,EAAgCC,gBAAhC,EAAkD;AAClES,WAAS,UADyD;AAElEC,QAAMf,MAF4D;AAGlEgB,QAAMT,OAH4D;AAIlEU,WAAS,KAJyD;AAKlEC,oBAAkBL,oBAAUM;AALsC,CAAlD,CAAlB;;AAQAC,aACGC,WADH,CACeC,SADf,EAEGC,MAFH,CAEU,gBAAQ;AACd,SAAQC,KAAKC,OAAL,CAAa,GAAb,MAAsB,CAAvB,IAA8BD,SAAShB,QAAvC,IAAqDgB,KAAKE,KAAL,CAAW,CAAC,CAAZ,MAAmB,KAA/E;AACD,CAJH,EAKGC,OALH,CAKW,gBAAQ;AACf,MAAMC,QAAQhB,UAAU,QAAV,EAAoBH,eAAKoB,IAAL,CAAUP,SAAV,EAAqBE,IAArB,CAApB,CAAd;AACAb,SAAOiB,MAAME,IAAb,IAAqBF,KAArB;AACD,CARH;;AAUAG,OAAOC,IAAP,CAAYrB,MAAZ,EAAoBgB,OAApB,CAA4B,qBAAa;AACvC,MAAIhB,OAAOsB,SAAP,EAAkBC,SAAtB,EAAiC;AAC/BvB,WAAOsB,SAAP,EAAkBC,SAAlB,CAA4BvB,MAA5B;AACD;AACF,CAJD;;AAMAA,OAAOC,SAAP,GAAmBA,SAAnB;AACAD,OAAOE,SAAP,GAAmBA,mBAAnB;;AAEAsB,QAAQC,GAAR,sBAA+B9B,OAA/B,cAA+CN,MAA/C,SAAyDO,OAAzD;;kBAEeI,M","file":"index.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport Sequelize from 'sequelize';\nimport DEFAULT_CONF from '../configs/default';\n\n\nconst DB_URI = process.env.DB_URI || DEFAULT_CONF.DB_URI;\nconst DB_USER = process.env.DB_USER || DEFAULT_CONF.DB_USER;\nconst DB_USER_PASSWORD = process.env.DB_USER_PASSWORD || DEFAULT_CONF.DB_USER_PASSWORD;\nconst DB_NAME = process.env.DB_NAME || DEFAULT_CONF.DB_NAME;\nconst DB_PORT = process.env.DB_PORT || DEFAULT_CONF.DB_PORT;\nconst basename = path.basename(__filename);\nconst models = {};\n\n// Connect to CockroachDB through Sequelize.\nconst sequelize = new Sequelize(DB_NAME, DB_USER, DB_USER_PASSWORD, {\n  dialect: 'postgres',\n  host: DB_URI,\n  port: DB_PORT,\n  logging: false,\n  operatorsAliases: Sequelize.Op,\n});\n\nfs\n  .readdirSync(__dirname)\n  .filter(file => {\n    return (file.indexOf('.') !== 0) && (file !== basename) && (file.slice(-3) === '.js');\n  })\n  .forEach(file => {\n    const model = sequelize['import'](path.join(__dirname, file));\n    models[model.name] = model;\n  });\n\nObject.keys(models).forEach(modelName => {\n  if (models[modelName].associate) {\n    models[modelName].associate(models);\n  }\n});\n\nmodels.sequelize = sequelize;\nmodels.Sequelize = Sequelize;\n\nconsole.log(`Connected to db(${DB_NAME}) at: ${DB_URI}:${DB_PORT}`);\n\nexport default models;\n"]}